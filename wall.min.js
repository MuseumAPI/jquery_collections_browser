/*
 * Victoria and Albert Museum Collections Browser jQuery plugin
 * http://www.vam.ac.uk/
 *
 * Copyright 2011, Victoria and Albert Museum
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */
(function(a){a.fn.wall=function(b){return this.each(function(){var z={width:1024,height:768,sizes:[{dim:130,suff:"_jpg_o",name:"Small images"},{dim:177,suff:"_jpg_ws",name:"Medium images"},{dim:265,suff:"_jpg_w",name:"Large images"},{dim:355,suff:"_jpg_ds",name:"X-Large images"}],start_size:2,tile_margin:8,sidebar_image_size:265,background_color:"#ffffff",tile_border_color:"#a1a1a1",img_fadein:500,fullscreen_speed:250,min_category_count:30,padding:8,wall_border:"1px solid #a1a1a1",panel_width:"auto",hide_loader_time:2000,fill_direction:"random",tag_style:"list",display_loading:false,search_box_default:"New search",alert_title:"Oops",alert_msg_no_images:"Sorry, there are not enough images for that search to fill the screen.",alert_msg_enter_search:"Please enter a search term and try again.",alert_msg_zoom_max:"Sorry, cannot zoom in any further.",alert_msg_zoom_min:"Sorry, cannot zoom out any further.",tips:["Try dragging the image grid to reveal more images.","You can change the size of the tiles using the zoom buttons in the panel below.","You can shuffle the images using the button in the panel below.","Try switching to full screen and back using the toggle fullscreen button.","Click on an image to reveal the sidebar with more information about the object.","You can load images from a category by clicking the category names in the sidebar.","You can drag this window.","You can search for similar objects by clicking the object name in the sidebar.","The search returns a maximum of 1000 objects."],api_stub:"http://www.vam.ac.uk/api/json/museumobject/",api_search_path:"search",images_url:"http://media.vam.ac.uk/media/thira/collection_images/",collections_record_url:"http://collections.vam.ac.uk/item/",search_term:"",category:{id:null,name:"",term:""},max_results:1000,limit:41,search_term:"","category-stub":"",sidebar_image_suffix:"_jpg_w",large_image_suffix:"_jpg_l",blank_tile:'<li class="blank"></li>',cache_interval:50,fill_interval:5,taxonomy:["styles","collections","subjects","names","exhibitions","galleries","techniques","materials","categories","places"],tombstone:[["Artist","artist"],["Date","date_text"],["Museum no.","museum_number"],["Materials &amp; techniques","materials_techniques"],["Location","location"],["History note","history_note"]]};var H=a.extend({},z,b);E(a(this),H);function E(T,N){N.current_size=N.start_size;N.tile_w=N.sizes[N.current_size].dim;N.tile_h=N.sizes[N.current_size].dim;N.tile_sidebar_image_suffix=N.sizes[N.current_size].suff;N.cell_w=N.tile_w+N.tile_margin+2;N.cell_h=N.tile_h+N.tile_margin+2;N.start_rows=Math.ceil(N.height/N.cell_h);N.start_cols=Math.ceil(N.width/N.cell_w);N.sidebar_width=N.sidebar_image_size;var U='<div id="grid">';for(i=0;i<N.start_rows;i++){U+=w(N.start_cols)}U+="</div>";T.html(U);N.start={top:T.position().top,left:T.position().left};N.fullscreen=false;T.css({width:N.width,height:N.height,"background-color":N.background_color,border:N.wall_border});a("#grid",T).css({width:N.cell_w*N.start_cols});F(T);var K='<div id="panel" class="ui-widget ui-widget-content ui-corner-all">';K+='<ul id="icons">';K+='<li><input class="ui-state-default ui-corner-all" type="text" name="search" value="'+N.search_box_default+'"></li>';K+='<li class="ui-state-default ui-corner-all"><span class="submitsearch ui-icon ui-icon-search" title="Submit search"></span></li>';K+='<li class="ui-state-default ui-corner-all"><span class="fullscreen ui-icon ui-icon-arrow-4-diag" title="Toggle full screen"></span></li>';K+='<li class="ui-state-default ui-corner-all"><span class="shuffle ui-icon ui-icon-shuffle" title="Shuffle images"></span></li>';K+='<li class="ui-state-default ui-corner-all"><span class="zoomin ui-icon ui-icon-zoomin" title="Larger tiles"></span></li>';K+='<li class="ui-state-default ui-corner-all"><span class="zoomout ui-icon ui-icon-zoomout" title="Smaller tiles"></span></li>';K+="</ul>";K+="</div>";var P='<div id="sidebar"  class="ui-dialog ui-widget ui-widget-content ui-corner-all">';P+='<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title object-title"></span><a href="#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div>';P+='<div class="sidebar_image"></div>';P+='<div class="sidebar_info"></div>';P+="</div>";var R='<div id="dialog" class="ui-dialog ui-widget ui-widget-content ui-corner-all">';R+='<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title">'+N.alert_title+'</span><a href="#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div>';R+='<p><span style="float: left; margin-right: .3em;" class="ui-icon ui-icon-alert"></span><span id="dialog_text"></span></p>';R+='<div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><div class="ui-dialog-buttonset"><button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" role="button" aria-disabled="false"><span class="ui-button-text">Ok</span></button></div></div>';R+="</div>";var M='<div id="loading" class="ui-dialog ui-widget ui-widget-content ui-corner-all">';M+='<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title">Please wait...</span><a href="#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div>';M+='<p class="results_info"></p>';M+='<div id="progressbar"></div>';M+="</div>";var S='<div class="ui-widget"><div id="title" class="ui-dialog ui-widget ui-widget-content ui-corner-all us-status-highlight">';S+='<h1 class="title_info"></h1>';S+="</div></div>";var Q='<div id="fullsize" class="ui-dialog ui-widget ui-widget-content ui-corner-all">';Q+='<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix"><span class="ui-dialog-title"></span><a href="#" class="ui-dialog-titlebar-close ui-corner-all" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div>';Q+='<img src="" alt="" title="" />';Q+="</div>";var O='<div id="disabled"></div>';a("#grid").after(P).after(K).after(R).after(M).after(S).after(Q).after(O);var L=a("#panel");L.css({left:T.width()/2-L.width()/2,bottom:0});allow_shuffle=false;fullsize_dragged=false;cache_full=false;C(T,N);a("#grid",T).draggable({cursor:"pointer",delay:150,stop:function(){y(a(this.parentNode))}});a("#loading",T).draggable({containment:"parent"});a("#fullsize",T).draggable({containment:"parent",stop:function(){fullsize_dragged=true}});T.delegate("#icons li span","mouseover",function(V){a(this).parent().addClass("ui-state-hover")}).delegate("#icons li span","mouseout",function(V){a(this).parent().removeClass("ui-state-hover")}).delegate("#panel span.fullscreen","click",function(V){V.preventDefault();var W=a("#sidebar",T);if(N.fullscreen){a("body").css({overflow:"auto"});T.prependTo(old_parent).animate({width:N.width,height:N.height,},N.fullscreen_speed,function(){if(W.is(":visible")){W.animate({width:N.sidebar_width,height:T.height()-2*N.padding,top:0,left:T.width()-(N.sidebar_width+2*N.padding),padding:N.padding},N.fullscreen_speed,function(){})}var Y=a("#panel",T);a("#sidebar").hide();Y.css({left:0}).css({left:T.width()/2-Y.width()/2,bottom:0});var X=a("#loading");X.css({left:T.width()/2-X.width()/2,});N.fullscreen=false;y(T)})}else{old_parent=T.parent();T.prependTo(a("body"));a("body").css({overflow:"hidden"});a(window).scrollTop(0);T.animate({width:a(document).width(),height:a(window).height(),},N.fullscreen_speed,function(){if(W.is(":visible")){W.animate({width:N.sidebar_width,height:T.height()-2*N.padding,top:0,left:T.width()-(N.sidebar_width+2*N.padding),padding:N.padding},N.fullscreen_speed,function(){a(".sidebar_info",W).height(W.height()-a(".sidebar_image").height())})}var Y=a("#panel");Y.css({left:T.width()/2-Y.width()/2,bottom:0});var X=a("#loading");X.css({left:T.width()/2-X.width()/2,});N.fullscreen=true;y(T)})}}).delegate("#panel span.zoomin","click",function(V){V.preventDefault();max_size=N.sizes.length-1;if(N.current_size<max_size){N.current_size++;J(T)}else{A(T,N.alert_msg_zoom_max)}}).delegate("#panel span.zoomout","click",function(V){V.preventDefault();if(N.current_size>0){N.current_size--;J(T)}else{A(T,N.alert_msg_zoom_min)}}).delegate("#panel span.submitsearch","click",function(V){V.preventDefault();search_term=a('#panel input[name="search"]',T).val();if(search_term!=""&&search_term!=N.search_box_default){N.category={id:null,name:"",term:"",};N.search_term=search_term;C(T,N)}else{A(T,N.alert_msg_enter_search)}}).delegate('#panel input[name="search"]',"keyup",function(W){W.preventDefault();var V=(W.keyCode?W.keyCode:W.which);if(V==13){search_term=a(this).val();if(search_term!=""&&search_term!=N.search_box_default){N.category={id:null,name:"",term:"",};N.search_term=search_term;C(T,N)}else{A(T,N.alert_msg_enter_search)}}}).delegate('#panel input[name="search"]',"focus",function(V){V.preventDefault();a(this).val("")}).delegate('#panel input[name="search"]',"click",function(V){V.preventDefault();a(this).val("")}).delegate(".searchable","click",function(V){search_term=a(this).html();a('#panel input[name="search"]',T).val(search_term);if(search_term!=""&&search_term!=N.search_box_default){N.category={id:null,name:"",term:"",};N.search_term=search_term;C(T,N)}else{A(T,N.alert_msg_enter_search)}}).delegate("#panel span.shuffle","click",function(V){V.preventDefault();if(allow_shuffle){keys=[];shuffle=[];for(d=0;d<N.max_offset;d++){shuffle[Math.random()*1]=d}for(r in shuffle){keys.push(r)}keys.sort();tiles=a("#grid li",T);count=0;for(k in keys){h(a(tiles[count]),D(shuffle[keys[k]],cache));count++}}}).delegate(".ui-dialog-titlebar-close","click",function(V){V.preventDefault();a(this).parent().parent().hide()}).delegate("button","click",function(V){V.preventDefault();a("#dialog",T).hide()}).delegate("#grid ul li","click",function(W){url=N.api_stub+a(this).data("objnum");a("#fullsize").hide();var X=a("#sidebar",T);X.css({width:N.sidebar_width,height:T.height()-2*N.padding,top:0,left:T.width()-(N.sidebar_width+2*N.padding),padding:N.padding});var V=a("#disabled",T);V.css({width:N.sidebar_width,height:T.height()-2*N.padding,top:0,left:T.width()-(N.sidebar_width+2*N.padding),padding:N.padding,"z-index":50}).show();if(!X.is(":visible")){X.show()}a.ajax({dataType:"jsonp",url:url,success:function(aa){musobj=aa[0].fields;image_url=N.images_url+musobj.primary_image_id.substr(0,6)+"/"+musobj.primary_image_id+N.sidebar_image_suffix+".jpg";objname=musobj.object;objtitle='<span id="objname" class="searchable" title="Search for \''+objname+"'\">"+objname+"</span>";if(musobj.title){objname+=": "+musobj.title;objtitle+=": "+musobj.title}var ab='<img src="'+image_url+'" title="'+objname+'" alt="'+objname+'" width="'+N.sidebar_image_size+'" height="'+N.sidebar_image_size+'">';a("span.object-title",X).html('<span class="ui-icon ui-icon-search" style="float: left; margin-right: 2px;"></span>'+objtitle);var Z="";if(typeof(musobj.descriptive_line)!="undefined"&&musobj.descriptive_line!=""&&musobj.descriptive_line!=["Unknown"]){Z+='<div class="ui-widget ui-state-highlight ui-corner-all">'+musobj.descriptive_line+"</div>"}Z+='<div class="ui-widget ui-state-highlight ui-corner-all">';Z+="<ul>";for(k=0;k<N.tombstone.length;k++){t=N.tombstone[k][0];c=N.tombstone[k][1];if(typeof(musobj[c])!="undefined"&&musobj[c]!=""&&musobj[c]!=["Unknown"]){Z+="<li><strong>"+t+"</strong>: "+musobj[c]+"</li>"}}Z+="</ul></div>";Z+='<div class="ui-widget ui-state-highlight ui-corner-all" id="browse">';Z+='<ul class="'+N.tag_style+'">';var Y=0;for(k=0;k<N.taxonomy.length;k++){category=musobj[N.taxonomy[k]];if(B(category)>0){taxonomy_title=I(N.taxonomy[k]);Y++;if(N.tag_style=="list"){Z+="<li><strong>"+taxonomy_title+"</strong>";Z+="<ul>"}for(L=0;L<category.length;L++){s=Math.floor(Math.random()*6);cat=category[L];category_name=I(cat.fields.name);if(cat.fields.museumobject_count>N.min_category_count&&category_name!="Unknown"){Y++;Z+='<li class="size-'+parseInt(s)+'"><a href="#" data-name="'+cat.model.split(".")[1]+'" data-pk="'+cat.pk+'" data-term="'+category_name+'" title="Browse images for \''+category_name+"'\">"+category_name+"</a></li>"}}if(N.tag_style=="list"){Z+="</ul>"}Z+="</li>"}}if(Y==0){Z+="<li>Sorry, no categories for this object.</li>"}Z+='</ul><div class="clearfix"></div></div>';a(".sidebar_image",X).html(ab);a(".sidebar_info",X).html(Z).height(X.height()-a(".sidebar_image").outerHeight()-a(".ui-dialog-titlebar",X).outerHeight()).scrollTop(0);var ac=new Image();ac.src=image_url.replace(N.sidebar_image_suffix,N.large_image_suffix);a("#fullsize img",T).attr("src",ac.src);a("#fullsize .ui-dialog-title").html(objname);V.fadeOut()}})}).delegate("#sidebar a.close","click",function(V){V.preventDefault();a("#sidebar",T).hide()}).delegate("#browse a","click",function(V){V.preventDefault();N.category={id:a(this).data("pk"),name:a(this).data("name"),term:a(this).data("term"),};C(T,N);a('#panel input[name="search"]',T).val("New search")}).delegate("#sidebar img","click",function(V){V.preventDefault();Q=a("#fullsize",T);if(!fullsize_dragged){Q.css({top:0,left:0})}Q.show()})}function g(K){l=a("#loading");l.css({left:K.width()/2-l.width()/2,top:K.height()/2-l.height()/2});a("span.ui-dialog-title",l).html("Please wait...");l.show()}function A(K,L){dia=a("#dialog",K);a("#dialog_text",dia).html(L);dia.css({left:K.width()/2-dia.width()/2,top:K.height()/2-dia.height()/2});dia.show()}function C(K,L){ajax_in_progress=true;a("#panel .shuffle").addClass("disabled");allow_shuffle=false;a.ajax({dataType:"jsonp",url:v(),success:function(M){if(M.meta.result_count<=L.min_category_count){A(K,L.alert_msg_no_images)}else{if(L.show_loading){g(K)}if(typeof(cache_loop_id)!="undefined"){clearInterval(cache_loop_id)}if(typeof(fill_loop_id)!="undefined"){clearInterval(fill_loop_id)}if(typeof(cache)!="undefined"){delete cache}offset=0;a("#grid ul li",K).addClass("blank");L.num_results=(M.meta.result_count>L.max_results)?L.max_results:M.meta.result_count;L.display_results=parseInt(L.num_results);L.grid_width=Math.floor(Math.sqrt(L.num_results));L.grid_height=L.grid_width;L.max_offset=L.grid_width*L.grid_height;if(L.category.id!=null){var N="Browsing "+L.num_results+" images for "+I(L.category.name)+": "+I(L.category.term)}else{var N="Browsing "+L.num_results+' images for "'+L.search_term+'"'}a("#title h1",K).html(N);a("#progressbar").progressbar({value:0,max:L.max_offset});a("#loading p.results_info",K).html('Loading <strong><span class="loaded">0</span>/'+L.display_results+"</strong> images");offset_anchor=0;num_cols=a("#grid>ul:first li",K).size();tiles=a("#grid>ul>li",K);count=0;row=0;o=offset_anchor;for(k=0;k<tiles.size();k++){a(tiles[k]).data("offset",o);count++;if(count==num_cols){count=0;row++;o=row*L.grid_width}else{o++}}ajax_in_progress=false;cache=new Array();cache_loop_id=setInterval(function(){f(L,cache)},L.cache_interval);fill_loop_id=setInterval(function(){x(L,cache)},L.fill_interval)}}});return true}function J(K){d=H.sizes[H.current_size];H.tile_w=d.dim;H.tile_h=d.dim;H.cell_w=H.tile_w+H.tile_margin+2;H.cell_h=H.tile_h+H.tile_margin+2;H.start_rows=Math.ceil(H.height/H.cell_h);H.start_cols=Math.ceil(H.width/H.cell_w);H.tile_sidebar_image_suffix=d.suff;a("#grid",K).html("");a("#panel a.resize").removeClass("selected");a(this).addClass("selected");y(K);offset_anchor=0;num_cols=a("#grid>ul:first li",K).size();tiles=a("#grid>ul>li",K);count=0;row=0;o=offset_anchor;for(k=0;k<tiles.size();k++){a(tiles[k]).data("offset",o);count++;if(count==num_cols){count=0;row++;o=row*H.grid_width}else{o++}}}function v(L,K){if(typeof(L)=="undefined"||isNaN(L)){L=0}if(typeof(K)=="undefined"||isNaN(K)){K=1}if(H.category.id!=null){url=H.api_stub;url+="?"+H.category.name+"="+H.category.id;url+="&getgroup="+H.category.name;display_term=I(H.category.term)}else{url=H.api_stub+H.api_search_path;url+="?q="+H.search_term;display_term=I(H.search_term)}url+="&limit="+K;url+="&offset="+L;url+="&images=1";return url}function w(K){r="<ul>";for(j=0;j<K;j++){r+=H.blank_tile}r+="</ul>";return r}function F(K){a("#grid li",K).css({width:H.tile_w,height:H.tile_h,"margin-right":H.tile_margin,"margin-bottom":H.tile_margin,"border-color":H.tile_border_color})}function B(K){var L=0;for(n=0;n<K.length;n++){if(K[0].fields.name!="Unknown"&&K[0].fields.museumobject_count>H.min_category_count){L++}}return L}function I(K){return K.charAt(0).toUpperCase()+K.substr(1)}function y(K){offset_anchor=a("#grid ul:first li:first",K).data("offset");var L=a("#grid",K);L.width(L.width()+K.position().left+K.width());tiles={N:Math.ceil(L.position().top/H.cell_h),S:Math.ceil((K.height()-L.position().top+L.height())/H.cell_h),E:Math.ceil((L.position().left+L.width())/H.cell_w),W:Math.ceil(L.position().left/H.cell_w)};for(prop in tiles){tiles[prop]=tiles[prop]<0?0:tiles[prop]}do_offsets=false;if(tiles.N){for(i=0;i<tiles.N;i++){L.prepend(w(a("#grid ul:first > li",K).size()))}do_offsets=true}if(tiles.S){for(i=0;i<tiles.S;i++){L.append(w(a("#grid ul:first > li",K).size()))}do_offsets=true}if(tiles.W){tl="";for(i=0;i<tiles.W;i++){tl+=H.blank_tile}a("#grid ul",K).prepend(tl);do_offsets=true}if(tiles.E){tr="";for(i=0;i<tiles.E;i++){tr+=H.blank_tile}a("#grid ul",K).append(tr);do_offsets=true}L.css({top:tiles.N>0?L.position().top-tiles.N*H.cell_h:L.position().top,left:tiles.W>0?L.position().left-tiles.W*H.cell_w:L.position().left,width:a("#grid ul:first > li",K).length*H.cell_w});F(K);remove={N:Math.floor(L.position().top*-1/H.cell_h),S:Math.floor((L.height()-K.height()+L.position().top)/H.cell_h),E:Math.floor((L.width()-K.width()+L.position().left)/H.cell_w),W:Math.floor(L.position().left*-1/H.cell_w)};for(p in remove){remove[p]=remove[p]<0?0:remove[p]}tiles_removed=0;while(tiles_removed<remove.W){a("#grid ul li:first-child").remove();tiles_removed++;L.css({left:L.position().left+H.cell_w})}tiles_removed=0;while(tiles_removed<remove.E){a("#grid ul li:last-child").remove();tiles_removed++}rows_removed=0;while(rows_removed<remove.N){a("#grid ul:first-child").remove();rows_removed++;L.css({top:L.position().top+H.cell_h})}rows_removed=0;while(rows_removed<remove.S){a("#grid ul:last-child").remove();rows_removed++}L.width(a("#grid ul:first > li",K).length*H.cell_w);if(do_offsets){e(K,tiles,remove,H)}}function e(L,M,K,N){offset_anchor=parseInt(offset_anchor);if(M.N>0){offset_anchor-=N.grid_width*M.N;if(offset_anchor<0){offset_anchor+=N.max_offset}}if(M.W>0){min=Math.floor(offset_anchor/N.grid_width)*N.grid_width;max=min+N.grid_width-1;offset_anchor-=M.W;if(offset_anchor<min){offset_anchor+=N.grid_width}}offset_anchor+=K.W;offset_anchor-=K.N*N.grid_width;if(offset_anchor<0){offset_anchor=0}offset=offset_anchor-N.limit;num_cols=a("#grid>ul:first li",L).size();rows=a("#grid>ul");for(j=0;j<rows.size();j++){o=offset_anchor+(j*N.grid_width);if(o>=N.max_offset){o-=N.max_offset}M=a("li",rows[j]);min=Math.floor(o/N.grid_width)*N.grid_width;max=min+N.grid_width-1;for(i=0;i<M.size();i++){a(M[i]).data("offset",o);o++;if(o>max){o=min}}o=max+1;if(o>=N.max_offset-1){o-=N.max_offset}}}function G(K,L){try{u=K+L.substr(0,6)+"/"+L+H.tile_sidebar_image_suffix+".jpg"}catch(M){u=""}return u}function D(K){for(q in cache){if(cache[q].offset==K){return cache[q]}}if(cache_full){a.ajax({dataType:"jsonp",url:v(K,1),success:function(L){for(i=0;i<L.records.length;i++){record=L.records[i];obj={};obj.offset=K;obj.imref=record.fields.primary_image_id;obj.num=record.fields.object_number;if(record.fields.title){objname=record.fields.object+" "+record.fields.title}else{objname=record.fields.object}obj.title=objname;cache.push(obj)}}})}return false}function f(L,K){if(typeof(offset)=="undefined"||isNaN(offset)||offset<0){offset=0}if(K.length<L.max_offset){cache_full=false;if(!ajax_in_progress){ajax_in_progress=true;url=v(offset,L.limit);a.ajax({dataType:"jsonp",url:url,success:function(M){for(i=0;i<M.records.length;i++){record=M.records[i];cache_obj={};cache_obj.offset=offset;cache_obj.imref=record.fields.primary_image_id;cache_obj.num=record.fields.object_number;if(record.fields.title){objname=record.fields.object+" "+record.fields.title}else{objname=record.fields.object}cache_obj.title=objname;K.push(cache_obj);offset++}if(offset>=L.max_offset&&K.length<L.max_offset){offset=0}ajax_in_progress=false;a("#progressbar").progressbar({value:K.length});a("#loading .loaded").html(K.length)}})}}else{a("#panel .shuffle").removeClass("disabled");allow_shuffle=true;clearInterval(cache_loop_id);cache_full=true;setTimeout(m,L.hide_loader_time);a("#loading .loaded").html(L.display_results);r=Math.floor(Math.random()*L.tips.length);a("#loading span.ui-dialog-title").html("Done.");a("#loading .results_info").html('<span style="float: left; margin-right: .3em;" class="ui-icon ui-icon-info"></span><strong>Tip:</strong> '+L.tips[r])}}function m(){a("#loading").fadeOut()}function h(L,K){L.css({"background-image":"url("+G(H.images_url,K.imref)+")"}).attr("title",K.title+" ["+K.num+"]").data("objnum",K.num).removeClass("blank")}function x(L,K){switch(L.fill_direction){case"forwards":t=a("ul li.blank:first");break;case"backwards":t=a("ul li.blank:last");break;case"random":tt=a("ul li.blank");t=a(tt[Math.floor(Math.random()*tt.length)]);break;default:t=a("ul li.blank:first");break}var M=D(t.data("offset"),K);if(M){h(t,M)}}})}})(jQuery);